<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="ä¸€ã€å¼•è¨€\råœ¨ C è¯­è¨€ä¸­ï¼Œç”±äºå…¶æœ¬èº«ç¼ºä¹å¦‚ C++ çš„åå°„ã€ç±»ç»§æ‰¿ã€æˆå‘˜æŒ‡é’ˆåå‘æŸ¥æ‰¾ç­‰é«˜çº§ç‰¹æ€§ï¼Œå¼€å‘è€…ç»å¸¸éœ€è¦å€ŸåŠ©ä¸€äº›æŠ€å·§æ¥å®ç°ç±»ä¼¼â€œå¯¹è±¡å…³è”â€æˆ–â€œç»“æ„ä½“æˆå‘˜åå‘å®šä½â€çš„åŠŸèƒ½ã€‚åœ¨ Linux å†…æ ¸ä»¥åŠä¼—å¤šç³»ç»Ÿçº§ C ç¨‹åºä¸­ï¼Œæœ‰ä¸€ä¸ªæä¸ºé‡è¦ä¸”ç»å…¸çš„å®ï¼Œç”¨äºè§£å†³å¦‚ä¸‹é—®é¢˜ï¼š\nå·²çŸ¥ä¸€ä¸ªç»“æ„ä½“ä¸­çš„æŸä¸ªæˆå‘˜çš„æŒ‡é’ˆï¼Œå¦‚ä½•è·å–åŒ…å«è¯¥æˆå‘˜çš„æ•´ä¸ªç»“æ„ä½“çš„æŒ‡é’ˆï¼Ÿ\nè¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ï¼šcontainer_of å®ã€‚\nå®ƒä¸ä»…æ˜¯ Linux å†…æ ¸ä¸­æ•°æ®ç»“æ„ï¼ˆå¦‚é“¾è¡¨ã€è®¾å¤‡æ¨¡å‹ç­‰ï¼‰å®ç°çš„åŸºç¡€å·¥å…·ï¼Œä¹Ÿæ˜¯ç†è§£ C è¯­è¨€æŒ‡é’ˆè¿ç®—ã€å®ç¼–ç¨‹ã€ç±»å‹ç³»ç»Ÿå’Œå†…å­˜æ¨¡å‹çš„æä½³æ¡ˆä¾‹ã€‚\näºŒã€container_of çš„ä½œç”¨\r1. é—®é¢˜èƒŒæ™¯\råœ¨ C è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸å®šä¹‰å¦‚ä¸‹çš„ç»“æ„ä½“ï¼š\n1struct Person { 2 int age; 3 char name[50]; 4 void *private_data; 5}; å½“æˆ‘ä»¬ä»…æŒæœ‰ä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“æŸä¸ªæˆå‘˜çš„æŒ‡é’ˆï¼ˆä¾‹å¦‚ &amp;p.private_dataï¼‰æ—¶ï¼Œæ ‡å‡† C å¹¶æ²¡æœ‰æä¾›ç›´æ¥çš„æ–¹æ³•æ¥è·å–è¯¥æˆå‘˜æ‰€å±çš„æ•´ä¸ªç»“æ„ä½“å¯¹è±¡çš„æŒ‡é’ˆï¼ˆä¾‹å¦‚ &amp;pï¼‰ã€‚\n2. container_of çš„åŠŸèƒ½\rcontainer_of å® é€šè¿‡ä¸€ä¸ªç»“æ„ä½“æˆå‘˜çš„æŒ‡é’ˆï¼Œè®¡ç®—å¹¶è¿”å›åŒ…å«è¯¥æˆå‘˜çš„æ•´ä¸ªç»“æ„ä½“çš„æŒ‡é’ˆã€‚\næ¢å¥è¯è¯´ï¼Œå®ƒæ˜¯ï¼š\nä¸€ç§é€šè¿‡â€œéƒ¨åˆ†â€ä¿¡æ¯ï¼ˆæˆå‘˜æŒ‡é’ˆï¼‰åæ¨å‡ºâ€œæ•´ä½“â€å¯¹è±¡ï¼ˆå®¿ä¸»ç»“æ„ä½“ï¼‰çš„æœºåˆ¶ã€‚\nä¸‰ã€container_of å®çš„æ ‡å‡†å®ç°\råœ¨ Linux å†…æ ¸ä¸­ï¼Œcontainer_of å®é€šå¸¸å®šä¹‰ä¸ºå¦‚ä¸‹å½¢å¼ï¼ˆä½¿ç”¨ GCC æ‰©å±•è¯­æ³•ï¼‰ï¼š\n1#define container_of(ptr, type, member) ({ \\ 2 const typeof(((type *)0)->member) *__mptr = (ptr); \\ 3 (type *)((char *)__mptr - offsetof(type, member)); \\ 4}) âš ï¸ æ³¨æ„ï¼šæ­¤å®ç°ä½¿ç”¨äº† GCC çš„è¯­å¥è¡¨è¾¾å¼ï¼ˆ ({ ... }) ï¼‰ ä¸ typeof å…³é”®å­—ï¼Œå±äº GCC æ‰©å±•è¯­æ³•ï¼Œå¹¶éæ ‡å‡† Cï¼Œä½†åœ¨ Linux å†…æ ¸ä¸­è¢«å¹¿æ³›é‡‡ç”¨ã€‚\n"><title>æ·±å…¥è§£æ container_ofâ€‹ å®ï¼šåŸç†ã€å®ç°ä¸åº”ç”¨</title><link rel=canonical href=https://blog.liushuiyu.cn/p/%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90-container_of-%E5%AE%8F%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0%E4%B8%8E%E5%BA%94%E7%94%A8/><link rel=stylesheet href=/scss/style.min.ae278c805800a943979bf29ae182404ef5a1e8351a2a4ccc3cc16f54ab699d33.css><meta property='og:title' content="æ·±å…¥è§£æ container_of\u200b å®ï¼šåŸç†ã€å®ç°ä¸åº”ç”¨"><meta property='og:description' content="ä¸€ã€å¼•è¨€\råœ¨ C è¯­è¨€ä¸­ï¼Œç”±äºå…¶æœ¬èº«ç¼ºä¹å¦‚ C++ çš„åå°„ã€ç±»ç»§æ‰¿ã€æˆå‘˜æŒ‡é’ˆåå‘æŸ¥æ‰¾ç­‰é«˜çº§ç‰¹æ€§ï¼Œå¼€å‘è€…ç»å¸¸éœ€è¦å€ŸåŠ©ä¸€äº›æŠ€å·§æ¥å®ç°ç±»ä¼¼â€œå¯¹è±¡å…³è”â€æˆ–â€œç»“æ„ä½“æˆå‘˜åå‘å®šä½â€çš„åŠŸèƒ½ã€‚åœ¨ Linux å†…æ ¸ä»¥åŠä¼—å¤šç³»ç»Ÿçº§ C ç¨‹åºä¸­ï¼Œæœ‰ä¸€ä¸ªæä¸ºé‡è¦ä¸”ç»å…¸çš„å®ï¼Œç”¨äºè§£å†³å¦‚ä¸‹é—®é¢˜ï¼š\nå·²çŸ¥ä¸€ä¸ªç»“æ„ä½“ä¸­çš„æŸä¸ªæˆå‘˜çš„æŒ‡é’ˆï¼Œå¦‚ä½•è·å–åŒ…å«è¯¥æˆå‘˜çš„æ•´ä¸ªç»“æ„ä½“çš„æŒ‡é’ˆï¼Ÿ\nè¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ï¼šcontainer_of å®ã€‚\nå®ƒä¸ä»…æ˜¯ Linux å†…æ ¸ä¸­æ•°æ®ç»“æ„ï¼ˆå¦‚é“¾è¡¨ã€è®¾å¤‡æ¨¡å‹ç­‰ï¼‰å®ç°çš„åŸºç¡€å·¥å…·ï¼Œä¹Ÿæ˜¯ç†è§£ C è¯­è¨€æŒ‡é’ˆè¿ç®—ã€å®ç¼–ç¨‹ã€ç±»å‹ç³»ç»Ÿå’Œå†…å­˜æ¨¡å‹çš„æä½³æ¡ˆä¾‹ã€‚\näºŒã€container_of çš„ä½œç”¨\r1. é—®é¢˜èƒŒæ™¯\råœ¨ C è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸å®šä¹‰å¦‚ä¸‹çš„ç»“æ„ä½“ï¼š\n1struct Person { 2 int age; 3 char name[50]; 4 void *private_data; 5}; å½“æˆ‘ä»¬ä»…æŒæœ‰ä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“æŸä¸ªæˆå‘˜çš„æŒ‡é’ˆï¼ˆä¾‹å¦‚ &amp;p.private_dataï¼‰æ—¶ï¼Œæ ‡å‡† C å¹¶æ²¡æœ‰æä¾›ç›´æ¥çš„æ–¹æ³•æ¥è·å–è¯¥æˆå‘˜æ‰€å±çš„æ•´ä¸ªç»“æ„ä½“å¯¹è±¡çš„æŒ‡é’ˆï¼ˆä¾‹å¦‚ &amp;pï¼‰ã€‚\n2. container_of çš„åŠŸèƒ½\rcontainer_of å® é€šè¿‡ä¸€ä¸ªç»“æ„ä½“æˆå‘˜çš„æŒ‡é’ˆï¼Œè®¡ç®—å¹¶è¿”å›åŒ…å«è¯¥æˆå‘˜çš„æ•´ä¸ªç»“æ„ä½“çš„æŒ‡é’ˆã€‚\næ¢å¥è¯è¯´ï¼Œå®ƒæ˜¯ï¼š\nä¸€ç§é€šè¿‡â€œéƒ¨åˆ†â€ä¿¡æ¯ï¼ˆæˆå‘˜æŒ‡é’ˆï¼‰åæ¨å‡ºâ€œæ•´ä½“â€å¯¹è±¡ï¼ˆå®¿ä¸»ç»“æ„ä½“ï¼‰çš„æœºåˆ¶ã€‚\nä¸‰ã€container_of å®çš„æ ‡å‡†å®ç°\råœ¨ Linux å†…æ ¸ä¸­ï¼Œcontainer_of å®é€šå¸¸å®šä¹‰ä¸ºå¦‚ä¸‹å½¢å¼ï¼ˆä½¿ç”¨ GCC æ‰©å±•è¯­æ³•ï¼‰ï¼š\n1#define container_of(ptr, type, member) ({ \\ 2 const typeof(((type *)0)->member) *__mptr = (ptr); \\ 3 (type *)((char *)__mptr - offsetof(type, member)); \\ 4}) âš ï¸ æ³¨æ„ï¼šæ­¤å®ç°ä½¿ç”¨äº† GCC çš„è¯­å¥è¡¨è¾¾å¼ï¼ˆ ({ ... }) ï¼‰ ä¸ typeof å…³é”®å­—ï¼Œå±äº GCC æ‰©å±•è¯­æ³•ï¼Œå¹¶éæ ‡å‡† Cï¼Œä½†åœ¨ Linux å†…æ ¸ä¸­è¢«å¹¿æ³›é‡‡ç”¨ã€‚\n"><meta property='og:url' content='https://blog.liushuiyu.cn/p/%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90-container_of-%E5%AE%8F%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0%E4%B8%8E%E5%BA%94%E7%94%A8/'><meta property='og:site_name' content='liushuiyuã®Blog'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Linux'><meta property='article:tag' content='ç¼–ç¨‹'><meta property='article:published_time' content='2025-09-13T16:36:27+08:00'><meta property='article:modified_time' content='2025-09-13T16:36:27+08:00'><meta property='og:image' content='https://tuchuang.liushuiyu.cn/img/linux-0120250913.webp'><meta name=twitter:title content="æ·±å…¥è§£æ container_of\u200b å®ï¼šåŸç†ã€å®ç°ä¸åº”ç”¨"><meta name=twitter:description content="ä¸€ã€å¼•è¨€\råœ¨ C è¯­è¨€ä¸­ï¼Œç”±äºå…¶æœ¬èº«ç¼ºä¹å¦‚ C++ çš„åå°„ã€ç±»ç»§æ‰¿ã€æˆå‘˜æŒ‡é’ˆåå‘æŸ¥æ‰¾ç­‰é«˜çº§ç‰¹æ€§ï¼Œå¼€å‘è€…ç»å¸¸éœ€è¦å€ŸåŠ©ä¸€äº›æŠ€å·§æ¥å®ç°ç±»ä¼¼â€œå¯¹è±¡å…³è”â€æˆ–â€œç»“æ„ä½“æˆå‘˜åå‘å®šä½â€çš„åŠŸèƒ½ã€‚åœ¨ Linux å†…æ ¸ä»¥åŠä¼—å¤šç³»ç»Ÿçº§ C ç¨‹åºä¸­ï¼Œæœ‰ä¸€ä¸ªæä¸ºé‡è¦ä¸”ç»å…¸çš„å®ï¼Œç”¨äºè§£å†³å¦‚ä¸‹é—®é¢˜ï¼š\nå·²çŸ¥ä¸€ä¸ªç»“æ„ä½“ä¸­çš„æŸä¸ªæˆå‘˜çš„æŒ‡é’ˆï¼Œå¦‚ä½•è·å–åŒ…å«è¯¥æˆå‘˜çš„æ•´ä¸ªç»“æ„ä½“çš„æŒ‡é’ˆï¼Ÿ\nè¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ï¼šcontainer_of å®ã€‚\nå®ƒä¸ä»…æ˜¯ Linux å†…æ ¸ä¸­æ•°æ®ç»“æ„ï¼ˆå¦‚é“¾è¡¨ã€è®¾å¤‡æ¨¡å‹ç­‰ï¼‰å®ç°çš„åŸºç¡€å·¥å…·ï¼Œä¹Ÿæ˜¯ç†è§£ C è¯­è¨€æŒ‡é’ˆè¿ç®—ã€å®ç¼–ç¨‹ã€ç±»å‹ç³»ç»Ÿå’Œå†…å­˜æ¨¡å‹çš„æä½³æ¡ˆä¾‹ã€‚\näºŒã€container_of çš„ä½œç”¨\r1. é—®é¢˜èƒŒæ™¯\råœ¨ C è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸å®šä¹‰å¦‚ä¸‹çš„ç»“æ„ä½“ï¼š\n1struct Person { 2 int age; 3 char name[50]; 4 void *private_data; 5}; å½“æˆ‘ä»¬ä»…æŒæœ‰ä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“æŸä¸ªæˆå‘˜çš„æŒ‡é’ˆï¼ˆä¾‹å¦‚ &amp;p.private_dataï¼‰æ—¶ï¼Œæ ‡å‡† C å¹¶æ²¡æœ‰æä¾›ç›´æ¥çš„æ–¹æ³•æ¥è·å–è¯¥æˆå‘˜æ‰€å±çš„æ•´ä¸ªç»“æ„ä½“å¯¹è±¡çš„æŒ‡é’ˆï¼ˆä¾‹å¦‚ &amp;pï¼‰ã€‚\n2. container_of çš„åŠŸèƒ½\rcontainer_of å® é€šè¿‡ä¸€ä¸ªç»“æ„ä½“æˆå‘˜çš„æŒ‡é’ˆï¼Œè®¡ç®—å¹¶è¿”å›åŒ…å«è¯¥æˆå‘˜çš„æ•´ä¸ªç»“æ„ä½“çš„æŒ‡é’ˆã€‚\næ¢å¥è¯è¯´ï¼Œå®ƒæ˜¯ï¼š\nä¸€ç§é€šè¿‡â€œéƒ¨åˆ†â€ä¿¡æ¯ï¼ˆæˆå‘˜æŒ‡é’ˆï¼‰åæ¨å‡ºâ€œæ•´ä½“â€å¯¹è±¡ï¼ˆå®¿ä¸»ç»“æ„ä½“ï¼‰çš„æœºåˆ¶ã€‚\nä¸‰ã€container_of å®çš„æ ‡å‡†å®ç°\råœ¨ Linux å†…æ ¸ä¸­ï¼Œcontainer_of å®é€šå¸¸å®šä¹‰ä¸ºå¦‚ä¸‹å½¢å¼ï¼ˆä½¿ç”¨ GCC æ‰©å±•è¯­æ³•ï¼‰ï¼š\n1#define container_of(ptr, type, member) ({ \\ 2 const typeof(((type *)0)->member) *__mptr = (ptr); \\ 3 (type *)((char *)__mptr - offsetof(type, member)); \\ 4}) âš ï¸ æ³¨æ„ï¼šæ­¤å®ç°ä½¿ç”¨äº† GCC çš„è¯­å¥è¡¨è¾¾å¼ï¼ˆ ({ ... }) ï¼‰ ä¸ typeof å…³é”®å­—ï¼Œå±äº GCC æ‰©å±•è¯­æ³•ï¼Œå¹¶éæ ‡å‡† Cï¼Œä½†åœ¨ Linux å†…æ ¸ä¸­è¢«å¹¿æ³›é‡‡ç”¨ã€‚\n"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://tuchuang.liushuiyu.cn/img/linux-0120250913.webp'></head><body class=article-page style=display:flex;flex-direction:column><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><l1 class=site-name><a href=/>liushuiyuã®Blog</a></l1></header><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>å½’æ¡£</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>æœç´¢</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>å…³äº</span></a></li></ol><ol class=right-menu><a href=https://inde.lsyblog.live/ target=_blank class=travelling-button><li id=travelling><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="icon icon-tabler icons-tabler-filled icon-tabler-train"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M11 5c6.634.0 10.853 3.11 10.996 7.754L22 13a3 3 0 01-3 3H3a1 1 0 01-1-1V6a1 1 0 011-1zM7 7H4v3h3zm4 0H9v3h3V7.026A19 19 0 0011 7m3.001.257L14 10h5.04c-.979-1.337-2.689-2.306-5.039-2.743M21 18a1 1 0 010 2H3a1 1 0 010-2z"/></svg></li></a><li id=dark-mode-toggle><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="icon icon-tabler icons-tabler-filled icon-tabler-moon"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 1.992a10 10 0 109.236 13.838c.341-.82-.476-1.644-1.298-1.31A6.5 6.5.0 0113.074 3.733l.077-.08c.551-.63.113-1.653-.758-1.653h-.266l-.068-.006-.06-.002z"/></svg></li></ol></aside><div class="container main-container flex on-phone--column extended"><aside class=right-sidebar><div class=sticky-container><div class=author-sticky><div class=widget><div class=author><figure class=site-avatar><img src=https://tuchuang.liushuiyu.cn/img/leftwing.png class=left-wing alt="Left Wing">
<a href=/about/><img src=/img/avatar.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><img src=https://tuchuang.liushuiyu.cn/img/rightwing.png class=right-wing alt="Right Wing">
<span class=emoji>ğŸ’–</span></figure><div class=site-meta><h1 class=about-site-name><a href=/about/>liushuiyu</a></h1><h2 class=about-site-description>é‚£å¹´åˆ†å¼€çš„å¤ªä»“ä¿ƒ<br>æˆ‘æ¬ ä½ ä¸€å¥è¯</h2><ol class=menu-social><li><img src=https://tuchuang.liushuiyu.cn/img/Wechatlogo.png alt=GitHub style=width:24px;height:24px></li><li><img src=https://tuchuang.liushuiyu.cn/img/QQlogo.png alt=GitHub style=width:24px;height:24px></li></ol></div></div></div><style>.author{background:var(--author-background)}.author{display:flex;justify-content:center;align-content:center;padding:0;border:none;height:300px}.author{border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);transition:.3s;position:relative;overflow:hidden;padding:1rem;display:flex;gap:8px;flex-direction:column;align-items:center}</style><style>.site-avatar{position:relative;margin:0;width:80px;height:80px;flex-shrink:0;margin-inline:auto;user-select:none;display:flex;align-items:center;justify-content:center}.site-avatar a img,.site-avatar .site-logo{border-radius:50%;position:relative;width:80px;height:80px;user-select:none}.site-avatar .left-wing{position:absolute;width:110px;height:auto;left:-105px;top:50%;transform:translateY(-60%);z-index:1;border-radius:0!important;user-select:none;pointer-events:none}.site-avatar .right-wing{position:absolute;width:110px;height:auto;right:-105px;top:50%;transform:translateY(-60%);z-index:1;border-radius:0!important;user-select:none;pointer-events:none}.site-avatar .emoji{position:absolute;width:25px;height:25px;line-height:25px;border-radius:100%;bottom:0;right:0;text-align:center;font-size:15px;background-color:var(--card-background);box-shadow:30px}.site-meta{display:flex;flex-direction:column;gap:10px;justify-content:center;margin-inline:auto;align-items:center;user-select:none}.about-site-name{color:#ecf0f1!important;margin:0;font-size:1.8rem;margin-top:10px;user-select:none}.about-site-name a{color:#ecf0f1!important}.about-site-description{margin-left:15px;color:rgba(255,255,255,.7);font-weight:400;margin-top:0;font-size:1.6rem;user-select:none;text-align:center}.menu-social svg{stroke:rgba(255,255,255,.7)}.author{background:var(--author-background);display:flex;justify-content:center;align-content:center;padding:0;border:none;height:300px;border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);transition:.3s;position:relative;overflow:visible;padding:1rem;display:flex;gap:8px;flex-direction:column;align-items:center}</style></div><div class=toc-sticky><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#ä¸€å¼•è¨€>ä¸€ã€å¼•è¨€</a></li><li><a href=#äºŒcontainer_of-çš„ä½œç”¨>äºŒã€<code>container_of</code> çš„ä½œç”¨</a><ol><li><a href=#1-é—®é¢˜èƒŒæ™¯>1. é—®é¢˜èƒŒæ™¯</a></li><li><a href=#2-container_of-çš„åŠŸèƒ½>2. <code>container_of</code> çš„åŠŸèƒ½</a></li></ol></li><li><a href=#ä¸‰container_of-å®çš„æ ‡å‡†å®ç°>ä¸‰ã€<code>container_of</code> å®çš„æ ‡å‡†å®ç°</a></li><li><a href=#å››container_of-çš„ç»„æˆä¸å·¥ä½œåŸç†>å››ã€<code>container_of</code> çš„ç»„æˆä¸å·¥ä½œåŸç†</a><ol><li><a href=#1-å®æ¥å£è¯´æ˜>1. å®æ¥å£è¯´æ˜</a></li><li><a href=#2-å®çš„å·¥ä½œç›®æ ‡>2. å®çš„å·¥ä½œç›®æ ‡</a></li><li><a href=#3-æ ¸å¿ƒå®ç°åŸç†>3. æ ¸å¿ƒå®ç°åŸç†</a></li></ol></li><li><a href=#äº”offsetof-å®åç§»é‡è®¡ç®—çš„æ ¸å¿ƒ>äº”ã€<code>offsetof</code> å®ï¼šåç§»é‡è®¡ç®—çš„æ ¸å¿ƒ</a><ol><li><a href=#1-ä»€ä¹ˆæ˜¯-offsetof>1. ä»€ä¹ˆæ˜¯ <code>offsetof</code>ï¼Ÿ</a></li><li><a href=#2-offsetof-çš„æ ‡å‡†å®ç°>2. <code>offsetof</code> çš„æ ‡å‡†å®ç°</a><ol><li><a href=#è¯¦ç»†è§£æ>è¯¦ç»†è§£æï¼š</a></li></ol></li><li><a href=#3-ä¸ºä»€ä¹ˆ-offsetof-æ˜¯å®‰å…¨çš„>3. ä¸ºä»€ä¹ˆ <code>offsetof</code> æ˜¯å®‰å…¨çš„ï¼Ÿ</a></li></ol></li><li><a href=#å…­container_of-å®çš„é€æ­¥è§£æ>å…­ã€<code>container_of</code> å®çš„é€æ­¥è§£æ</a><ol><li><a href=#æ­¥éª¤è§£æ>æ­¥éª¤è§£æï¼š</a></li></ol></li><li><a href=#ä¸ƒå®Œæ•´ç¤ºä¾‹ä»£ç >ä¸ƒã€å®Œæ•´ç¤ºä¾‹ä»£ç </a><ol><li><a href=#è¾“å‡ºç¤ºä¾‹>è¾“å‡ºç¤ºä¾‹ï¼š</a></li></ol></li><li><a href=#å…«å…³é”®æŠ€æœ¯ä¸ç–‘éš¾ç‚¹è§£æ>å…«ã€å…³é”®æŠ€æœ¯ä¸ç–‘éš¾ç‚¹è§£æ</a><ol><li><a href=#1-ä¸ºä»€ä¹ˆéœ€è¦-container_of>1. ä¸ºä»€ä¹ˆéœ€è¦ <code>container_of</code>ï¼Ÿ</a></li><li><a href=#3-offsetof-çš„å®ç°å®‰å…¨å—>3. <code>offsetof</code> çš„å®ç°å®‰å…¨å—ï¼Ÿ</a></li><li><a href=#4-container_of-è¿”å›çš„æ˜¯ä»€ä¹ˆ>4. <code>container_of</code> è¿”å›çš„æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><li><a href=#5-ä¸ºä»€ä¹ˆä½¿ç”¨-typeofåœ¨-gcc-ç‰ˆæœ¬ä¸­>5. ä¸ºä»€ä¹ˆä½¿ç”¨ <code>typeof</code>ï¼ˆåœ¨ GCC ç‰ˆæœ¬ä¸­ï¼‰ï¼Ÿ</a></li></ol></li><li><a href=#ä¹æ€»ç»“>ä¹ã€æ€»ç»“</a></li></ol></nav></div></section></div></div></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90-container_of-%E5%AE%8F%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0%E4%B8%8E%E5%BA%94%E7%94%A8/><img src=https://tuchuang.liushuiyu.cn/img/linux-0120250913.webp loading=lazy alt="Featured image of post æ·±å…¥è§£æ container_ofâ€‹ å®ï¼šåŸç†ã€å®ç°ä¸åº”ç”¨"></a></div><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/p/%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90-container_of-%E5%AE%8F%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0%E4%B8%8E%E5%BA%94%E7%94%A8/>æ·±å…¥è§£æ container_ofâ€‹ å®ï¼šåŸç†ã€å®ç°ä¸åº”ç”¨</a></h2></div><footer class=article-time><header class=article-category><a href=/categories/%E4%BB%A3%E7%A0%81%E7%BC%96%E7%A8%8B/>ä»£ç ç¼–ç¨‹</a></header><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2025-9-13</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 3 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><h2 id=ä¸€å¼•è¨€>ä¸€ã€å¼•è¨€</h2><p>åœ¨ C è¯­è¨€ä¸­ï¼Œç”±äºå…¶æœ¬èº«ç¼ºä¹å¦‚ C++ çš„åå°„ã€ç±»ç»§æ‰¿ã€æˆå‘˜æŒ‡é’ˆåå‘æŸ¥æ‰¾ç­‰é«˜çº§ç‰¹æ€§ï¼Œå¼€å‘è€…ç»å¸¸éœ€è¦å€ŸåŠ©ä¸€äº›æŠ€å·§æ¥å®ç°ç±»ä¼¼â€œå¯¹è±¡å…³è”â€æˆ–â€œç»“æ„ä½“æˆå‘˜åå‘å®šä½â€çš„åŠŸèƒ½ã€‚åœ¨ Linux å†…æ ¸ä»¥åŠä¼—å¤šç³»ç»Ÿçº§ C ç¨‹åºä¸­ï¼Œæœ‰ä¸€ä¸ªæä¸ºé‡è¦ä¸”ç»å…¸çš„å®ï¼Œç”¨äºè§£å†³å¦‚ä¸‹é—®é¢˜ï¼š</p><blockquote><p><strong>å·²çŸ¥ä¸€ä¸ªç»“æ„ä½“ä¸­çš„æŸä¸ªæˆå‘˜çš„æŒ‡é’ˆï¼Œå¦‚ä½•è·å–åŒ…å«è¯¥æˆå‘˜çš„æ•´ä¸ªç»“æ„ä½“çš„æŒ‡é’ˆï¼Ÿ</strong></p></blockquote><p>è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ï¼š<strong><code>container_of</code></strong> <strong>å®</strong>ã€‚</p><p>å®ƒä¸ä»…æ˜¯ Linux å†…æ ¸ä¸­æ•°æ®ç»“æ„ï¼ˆå¦‚é“¾è¡¨ã€è®¾å¤‡æ¨¡å‹ç­‰ï¼‰å®ç°çš„åŸºç¡€å·¥å…·ï¼Œä¹Ÿæ˜¯ç†è§£ C è¯­è¨€æŒ‡é’ˆè¿ç®—ã€å®ç¼–ç¨‹ã€ç±»å‹ç³»ç»Ÿå’Œå†…å­˜æ¨¡å‹çš„æä½³æ¡ˆä¾‹ã€‚</p><hr><h2 id=äºŒcontainer_of-çš„ä½œç”¨>äºŒã€<code>container_of</code> çš„ä½œç”¨</h2><h3 id=1-é—®é¢˜èƒŒæ™¯>1. é—®é¢˜èƒŒæ™¯</h3><p>åœ¨ C è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸å®šä¹‰å¦‚ä¸‹çš„ç»“æ„ä½“ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln>1</span><span class=cl><span class=k>struct</span> <span class=n>Person</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>    <span class=kt>int</span> <span class=n>age</span><span class=p>;</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>    <span class=kt>char</span> <span class=n>name</span><span class=p>[</span><span class=mi>50</span><span class=p>];</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>    <span class=kt>void</span> <span class=o>*</span><span class=n>private_data</span><span class=p>;</span>
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=p>};</span></span></span></code></pre></div><p>å½“æˆ‘ä»¬ä»…æŒæœ‰ä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“<strong>æŸä¸ªæˆå‘˜</strong>çš„æŒ‡é’ˆï¼ˆä¾‹å¦‚ <code>&amp;p.private_data</code>ï¼‰æ—¶ï¼Œæ ‡å‡† C å¹¶æ²¡æœ‰æä¾›ç›´æ¥çš„æ–¹æ³•æ¥è·å–è¯¥æˆå‘˜æ‰€å±çš„<strong>æ•´ä¸ªç»“æ„ä½“å¯¹è±¡</strong>çš„æŒ‡é’ˆï¼ˆä¾‹å¦‚ <code>&amp;p</code>ï¼‰ã€‚</p><h3 id=2-container_of-çš„åŠŸèƒ½>2. <code>container_of</code> çš„åŠŸèƒ½</h3><p><code>container_of</code> å® <strong>é€šè¿‡ä¸€ä¸ªç»“æ„ä½“æˆå‘˜çš„æŒ‡é’ˆï¼Œè®¡ç®—å¹¶è¿”å›åŒ…å«è¯¥æˆå‘˜çš„æ•´ä¸ªç»“æ„ä½“çš„æŒ‡é’ˆ</strong>ã€‚</p><p>æ¢å¥è¯è¯´ï¼Œå®ƒæ˜¯ï¼š</p><blockquote><p>ä¸€ç§é€šè¿‡â€œéƒ¨åˆ†â€ä¿¡æ¯ï¼ˆæˆå‘˜æŒ‡é’ˆï¼‰åæ¨å‡ºâ€œæ•´ä½“â€å¯¹è±¡ï¼ˆå®¿ä¸»ç»“æ„ä½“ï¼‰çš„æœºåˆ¶ã€‚</p></blockquote><hr><h2 id=ä¸‰container_of-å®çš„æ ‡å‡†å®ç°>ä¸‰ã€<code>container_of</code> å®çš„æ ‡å‡†å®ç°</h2><p>åœ¨ Linux å†…æ ¸ä¸­ï¼Œ<code>container_of</code> å®é€šå¸¸å®šä¹‰ä¸ºå¦‚ä¸‹å½¢å¼ï¼ˆä½¿ç”¨ GCC æ‰©å±•è¯­æ³•ï¼‰ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln>1</span><span class=cl><span class=cp>#define container_of(ptr, type, member) ({              \
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=cp>    const typeof(((type *)0)-&gt;member) *__mptr = (ptr);  \
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=cp>    (type *)((char *)__mptr - offsetof(type, member));  \
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=cp>})</span></span></span></code></pre></div><blockquote><p>âš ï¸ æ³¨æ„ï¼šæ­¤å®ç°ä½¿ç”¨äº† <strong>GCC çš„è¯­å¥è¡¨è¾¾å¼ï¼ˆ</strong> <strong><code>({ ... })</code></strong> <strong>ï¼‰</strong> ä¸ <strong><code>typeof</code></strong> <strong>å…³é”®å­—</strong>ï¼Œå±äº <strong>GCC æ‰©å±•è¯­æ³•</strong>ï¼Œå¹¶éæ ‡å‡† Cï¼Œä½†åœ¨ Linux å†…æ ¸ä¸­è¢«å¹¿æ³›é‡‡ç”¨ã€‚</p></blockquote><p>è‹¥éœ€ç¼–å†™æ›´å…·å¯ç§»æ¤æ€§ã€ç¬¦åˆæ ‡å‡† C çš„ç‰ˆæœ¬ï¼Œå¯ç®€åŒ–ä¸ºï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln>1</span><span class=cl><span class=cp>#define container_of(ptr, type, member) \
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=cp>    ((type *)((char *)(ptr) - offsetof(type, member)))</span></span></span></code></pre></div><p>ä¸‹é¢æˆ‘ä»¬å°†å›´ç»•è¿™ä¸ªå®ï¼Œæ·±å…¥è®²è§£å®ƒçš„<strong>ç»„æˆã€åŸç†ã€å…³é”®ç‚¹ä¸å®ç°ç»†èŠ‚</strong>ã€‚</p><hr><h2 id=å››container_of-çš„ç»„æˆä¸å·¥ä½œåŸç†>å››ã€<code>container_of</code> çš„ç»„æˆä¸å·¥ä½œåŸç†</h2><h3 id=1-å®æ¥å£è¯´æ˜>1. å®æ¥å£è¯´æ˜</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=ln>1</span><span class=cl>container_of(ptr, type, member)</span></span></code></pre></div><div class=table-wrapper><table><thead><tr><th>å‚æ•°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>ptr</code></td><td>æŒ‡å‘ç»“æ„ä½“ä¸­æŸä¸ªæˆå‘˜çš„æŒ‡é’ˆï¼ˆä¾‹å¦‚<code>&amp;p.private_data</code>ï¼‰</td></tr><tr><td><code>type</code></td><td>è¯¥æˆå‘˜æ‰€å±çš„ç»“æ„ä½“ç±»å‹ï¼ˆä¾‹å¦‚<code>struct Person</code>ï¼‰</td></tr><tr><td><code>member</code></td><td>è¯¥æˆå‘˜åœ¨ç»“æ„ä½“ä¸­çš„åç§°ï¼ˆä¾‹å¦‚<code>private_data</code>ï¼‰</td></tr></tbody></table></div><h3 id=2-å®çš„å·¥ä½œç›®æ ‡>2. å®çš„å·¥ä½œç›®æ ‡</h3><p>é€šè¿‡ä¼ å…¥çš„æˆå‘˜æŒ‡é’ˆ <code>ptr</code>ï¼Œè®¡ç®—å¹¶è¿”å›åŒ…å«è¯¥æˆå‘˜çš„<strong>æ•´ä¸ªç»“æ„ä½“å¯¹è±¡çš„æŒ‡é’ˆ</strong>ã€‚</p><hr><h3 id=3-æ ¸å¿ƒå®ç°åŸç†>3. æ ¸å¿ƒå®ç°åŸç†</h3><p><code>container_of</code> çš„å®ç°ä¾èµ–äºä»¥ä¸‹ä¸¤ä¸ªå…³é”®æŠ€æœ¯ï¼š</p><ol><li><strong><code>offsetof(type, member)</code></strong> <strong>ï¼šè®¡ç®—æˆå‘˜åœ¨ç»“æ„ä½“ä¸­çš„åç§»å­—èŠ‚æ•°</strong></li><li><strong>æŒ‡é’ˆè¿ç®—ï¼šé€šè¿‡æˆå‘˜æŒ‡é’ˆå‡å»å…¶åç§»é‡ï¼Œåæ¨å‡ºç»“æ„ä½“èµ·å§‹åœ°å€</strong></li></ol><hr><h2 id=äº”offsetof-å®åç§»é‡è®¡ç®—çš„æ ¸å¿ƒ>äº”ã€<code>offsetof</code> å®ï¼šåç§»é‡è®¡ç®—çš„æ ¸å¿ƒ</h2><h3 id=1-ä»€ä¹ˆæ˜¯-offsetof>1. ä»€ä¹ˆæ˜¯ <code>offsetof</code>ï¼Ÿ</h3><blockquote><p><code>offsetof(type, member)</code> æ˜¯ä¸€ä¸ª<strong>å®</strong>ï¼Œç”¨äºè®¡ç®—ç»“æ„ä½“ <code>type</code> ä¸­çš„æˆå‘˜ <code>member</code> ç›¸å¯¹äºç»“æ„ä½“èµ·å§‹åœ°å€çš„<strong>åç§»å­—èŠ‚æ•°</strong>ã€‚</p></blockquote><p>ä¾‹å¦‚ï¼Œå¦‚æœç»“æ„ä½“èµ·å§‹åœ°å€ä¸º <code>0x1000</code>ï¼Œè€Œæˆå‘˜ <code>private_data</code> çš„åœ°å€ä¸º <code>0x1036</code>ï¼Œé‚£ä¹ˆï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln>1</span><span class=cl><span class=nf>offsetof</span><span class=p>(</span><span class=k>struct</span> <span class=n>Person</span><span class=p>,</span> <span class=n>private_data</span><span class=p>)</span> <span class=o>==</span> <span class=mh>0x36</span>  <span class=c1>// å³ 54 å­—èŠ‚
</span></span></span></code></pre></div><hr><h3 id=2-offsetof-çš„æ ‡å‡†å®ç°>2. <code>offsetof</code> çš„æ ‡å‡†å®ç°</h3><p>åœ¨å¤§å¤šæ•°æ ‡å‡† C åº“ï¼ˆå¦‚ glibcï¼‰å’Œç¼–è¯‘å™¨ä¸­ï¼Œ<code>offsetof</code> çš„å®ç°é€šå¸¸å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=ln>1</span><span class=cl>#define offsetof(type, member) ((size_t) &amp;((type *)0)-&gt;member)</span></span></code></pre></div><h4 id=è¯¦ç»†è§£æ>è¯¦ç»†è§£æï¼š</h4><ul><li><p><code>(type *)0</code>ï¼šå°†æ•´æ•°å€¼ <code>0</code> å¼ºåˆ¶è½¬æ¢ä¸ºä¸€ä¸ªæŒ‡å‘ <code>type</code> ç±»å‹çš„æŒ‡é’ˆã€‚å®ƒè¡¨ç¤º <strong>â€œå‡è®¾å­˜åœ¨ä¸€ä¸ª type ç±»å‹çš„å¯¹è±¡ï¼Œå…¶åœ°å€ä¸º 0â€</strong> ã€‚</p><p>âš ï¸ <strong>æ³¨æ„ï¼šè¿™é‡Œå¹¶æ²¡æœ‰çœŸçš„è®¿é—®åœ°å€ 0 çš„å†…å­˜ï¼Œåªæ˜¯æ„é€ äº†ä¸€ä¸ªæŒ‡é’ˆç”¨äºç±»å‹æ¨å¯¼å’Œåç§»è®¡ç®—ã€‚</strong></p></li><li><p><code>((type *)0)->member</code>ï¼šè®¿é—®è¯¥ï¼ˆå‡è®¾ï¼‰å¯¹è±¡çš„æˆå‘˜ <code>member</code>ã€‚</p></li><li><p><code>&((type *)0)->member</code>ï¼š<strong>å–è¯¥æˆå‘˜çš„åœ°å€</strong>ã€‚ç”±äºç»“æ„ä½“å‡è®¾ä½äºåœ°å€ 0ï¼Œå› æ­¤è¯¥åœ°å€çš„å€¼å°±æ˜¯æˆå‘˜ç›¸å¯¹äºç»“æ„ä½“èµ·å§‹åœ°å€çš„<strong>åç§»å­—èŠ‚æ•°</strong>ã€‚</p></li><li><p><code>(size_t)</code>ï¼šå°†å¾—åˆ°çš„åœ°å€å€¼ï¼ˆæŒ‡é’ˆï¼‰å¼ºåˆ¶è½¬æ¢ä¸º <code>size_t</code> ç±»å‹ï¼ˆä¸€ç§æ— ç¬¦å·æ•´å‹ï¼Œé€šå¸¸ç”¨äºè¡¨ç¤ºå¤§å°æˆ–åç§»ï¼‰ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæˆå‘˜åœ¨ç»“æ„ä½“ä¸­çš„åç§»é‡ã€‚</p></li></ul><hr><h3 id=3-ä¸ºä»€ä¹ˆ-offsetof-æ˜¯å®‰å…¨çš„>3. ä¸ºä»€ä¹ˆ <code>offsetof</code> æ˜¯å®‰å…¨çš„ï¼Ÿ</h3><p>å°½ç®¡ä»£ç ä¸­å‡ºç°äº† <code>(type *)0</code>ï¼Œä½†ç”±äºæˆ‘ä»¬<strong>ä»…ç”¨å®ƒæ¥è®¡ç®—æˆå‘˜çš„åœ°å€ï¼Œè€Œå¹¶æœªçœŸæ­£è§£å¼•ç”¨è¯¥æŒ‡é’ˆå»è®¿é—®å†…å­˜</strong>ï¼Œå› æ­¤ï¼š</p><p>âœ… å®ƒæ˜¯<strong>ç¼–è¯‘æœŸå®Œæˆçš„è®¡ç®—</strong>
âœ… å®ƒ<strong>ä¸ä¼šåœ¨è¿è¡Œæ—¶è®¿é—®åœ°å€ 0 çš„å†…å­˜</strong>
âœ… å®ƒæ˜¯<strong>å®‰å…¨ä¸”è¢«æ ‡å‡†å¹¿æ³›æ¥å—çš„åšæ³•</strong></p><hr><h2 id=å…­container_of-å®çš„é€æ­¥è§£æ>å…­ã€<code>container_of</code> å®çš„é€æ­¥è§£æ</h2><p>ä»¥å¦‚ä¸‹è°ƒç”¨ä¸ºä¾‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln>1</span><span class=cl><span class=k>struct</span> <span class=n>Person</span> <span class=o>*</span><span class=n>p_ptr</span> <span class=o>=</span> <span class=nf>container_of</span><span class=p>(</span><span class=o>&amp;</span><span class=n>p</span><span class=p>.</span><span class=n>private_data</span><span class=p>,</span> <span class=k>struct</span> <span class=n>Person</span><span class=p>,</span> <span class=n>private_data</span><span class=p>);</span></span></span></code></pre></div><p>å‡è®¾è¯¥å®å±•å¼€åä¸ºï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln>1</span><span class=cl><span class=p>(</span><span class=n>type</span> <span class=o>*</span><span class=p>)((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=n>__mptr</span> <span class=o>-</span> <span class=nf>offsetof</span><span class=p>(</span><span class=n>type</span><span class=p>,</span> <span class=n>member</span><span class=p>))</span></span></span></code></pre></div><h3 id=æ­¥éª¤è§£æ>æ­¥éª¤è§£æï¼š</h3><ol><li><p><strong>è¾“å…¥ï¼š</strong></p><ul><li><code>ptr</code> æ˜¯æŒ‡å‘æˆå‘˜çš„æŒ‡é’ˆï¼Œä¾‹å¦‚ <code>&amp;p.private_data</code></li><li><code>type</code> æ˜¯ç»“æ„ä½“ç±»å‹ï¼Œä¾‹å¦‚ <code>struct Person</code></li><li><code>member</code> æ˜¯æˆå‘˜åç§°ï¼Œä¾‹å¦‚ <code>private_data</code></li></ul></li><li><p><strong>è®¡ç®—æˆå‘˜åç§»é‡ï¼š</strong></p><ul><li>è°ƒç”¨ <code>offsetof(type, member)</code>ï¼Œå¾—åˆ°æˆå‘˜ <code>private_data</code> åœ¨ç»“æ„ä½“ä¸­çš„åç§»å­—èŠ‚æ•°ï¼ˆä¾‹å¦‚ 54ï¼‰</li></ul></li><li><p><strong>å°†æˆå‘˜æŒ‡é’ˆè½¬æ¢ä¸ºå­—èŠ‚æŒ‡é’ˆï¼š</strong></p><ul><li>å°† <code>ptr</code>ï¼ˆå¯èƒ½ä¸º <code>void *</code> ç±»å‹ï¼‰å¼ºåˆ¶è½¬æ¢ä¸º <code>char *</code>ï¼Œå› ä¸º <code>char</code> çš„å¤§å°ä¸º 1 å­—èŠ‚ï¼Œä¾¿äºè¿›è¡Œ<strong>æŒ‰å­—èŠ‚ç²¾ç¡®è®¡ç®—</strong></li></ul></li><li><p><strong>è®¡ç®—ç»“æ„ä½“èµ·å§‹åœ°å€ï¼š</strong></p><ul><li>ç”¨æˆå‘˜æŒ‡é’ˆçš„åœ°å€ï¼Œå‡å»è¯¥æˆå‘˜çš„åç§»é‡ï¼Œå¾—åˆ°ç»“æ„ä½“çš„èµ·å§‹åœ°å€</li></ul></li><li><p><strong>ç±»å‹è½¬æ¢ï¼š</strong></p><ul><li>å°†è®¡ç®—å‡ºçš„åœ°å€å¼ºåˆ¶è½¬æ¢å›ç»“æ„ä½“ç±»å‹æŒ‡é’ˆï¼Œå¦‚ <code>(struct Person *)</code>ï¼Œä»è€Œå¾—åˆ°æŒ‡å‘æ•´ä¸ªç»“æ„ä½“çš„æŒ‡é’ˆ</li></ul></li></ol><hr><h2 id=ä¸ƒå®Œæ•´ç¤ºä¾‹ä»£ç >ä¸ƒã€å®Œæ•´ç¤ºä¾‹ä»£ç </h2><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´ã€å¯è¿è¡Œçš„ç¤ºä¾‹ç¨‹åºï¼Œæ¼”ç¤º <code>container_of</code> çš„ä½¿ç”¨ä¸åŸç†ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln> 1</span><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stddef.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=cp></span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1>// å®šä¹‰ container_of å®ï¼ˆæ ‡å‡† C å…¼å®¹ç‰ˆæœ¬ï¼‰
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1></span><span class=cp>#define container_of(ptr, type, member) \
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=cp>    ((type *)((char *)(ptr) - offsetof(type, member)))
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=cp></span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1>// å®šä¹‰æµ‹è¯•ç»“æ„ä½“
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=c1></span><span class=k>struct</span> <span class=n>Person</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=kt>int</span> <span class=n>age</span><span class=p>;</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>    <span class=kt>char</span> <span class=n>name</span><span class=p>[</span><span class=mi>50</span><span class=p>];</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=kt>void</span> <span class=o>*</span><span class=n>private_data</span><span class=p>;</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=k>struct</span> <span class=n>Person</span> <span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=n>p</span><span class=p>.</span><span class=n>age</span> <span class=o>=</span> <span class=mi>25</span><span class=p>;</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=nf>snprintf</span><span class=p>(</span><span class=n>p</span><span class=p>.</span><span class=n>name</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>p</span><span class=p>.</span><span class=n>name</span><span class=p>),</span> <span class=s>&#34;Alice&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>    <span class=n>p</span><span class=p>.</span><span class=n>private_data</span> <span class=o>=</span> <span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=p>)</span><span class=mh>0xDEADBEEF</span><span class=p>;</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>
</span></span><span class=line><span class=ln>21</span><span class=cl>    <span class=c1>// è·å–æˆå‘˜ private_data çš„æŒ‡é’ˆ
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=c1></span>    <span class=kt>void</span> <span class=o>*</span><span class=n>ptr</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>p</span><span class=p>.</span><span class=n>private_data</span><span class=p>;</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>
</span></span><span class=line><span class=ln>24</span><span class=cl>    <span class=c1>// é€šè¿‡ container_of è·å–åŒ…å«è¯¥æˆå‘˜çš„ç»“æ„ä½“æŒ‡é’ˆ
</span></span></span><span class=line><span class=ln>25</span><span class=cl><span class=c1></span>    <span class=k>struct</span> <span class=n>Person</span> <span class=o>*</span><span class=n>p_found</span> <span class=o>=</span> <span class=nf>container_of</span><span class=p>(</span><span class=n>ptr</span><span class=p>,</span> <span class=k>struct</span> <span class=n>Person</span><span class=p>,</span> <span class=n>private_data</span><span class=p>);</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>
</span></span><span class=line><span class=ln>27</span><span class=cl>    <span class=c1>// è¾“å‡ºéªŒè¯
</span></span></span><span class=line><span class=ln>28</span><span class=cl><span class=c1></span>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Original person   : %p</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>p</span><span class=p>);</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Found person      : %p</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>p_found</span><span class=p>);</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Member private_data: %p</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>p_found</span><span class=o>-&gt;</span><span class=n>private_data</span><span class=p>);</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>
</span></span><span class=line><span class=ln>32</span><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>p_found</span> <span class=o>==</span> <span class=o>&amp;</span><span class=n>p</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;âœ… container_of æˆåŠŸæ‰¾åˆ°äº†åŸå§‹ç»“æ„ä½“ï¼</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;âŒ é”™è¯¯ï¼šæœªæ­£ç¡®æ‰¾åˆ°ç»“æ„ä½“</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>
</span></span><span class=line><span class=ln>38</span><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>39</span><span class=cl><span class=p>}</span></span></span></code></pre></div><h3 id=è¾“å‡ºç¤ºä¾‹>è¾“å‡ºç¤ºä¾‹ï¼š</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=ln>1</span><span class=cl>Original person   : 0x7ffd12345678
</span></span><span class=line><span class=ln>2</span><span class=cl>Found person      : 0x7ffd12345678
</span></span><span class=line><span class=ln>3</span><span class=cl>Member private_data: 0xdeadbeef
</span></span><span class=line><span class=ln>4</span><span class=cl>âœ… container_of æˆåŠŸæ‰¾åˆ°äº†åŸå§‹ç»“æ„ä½“ï¼</span></span></code></pre></div><hr><h2 id=å…«å…³é”®æŠ€æœ¯ä¸ç–‘éš¾ç‚¹è§£æ>å…«ã€å…³é”®æŠ€æœ¯ä¸ç–‘éš¾ç‚¹è§£æ</h2><h3 id=1-ä¸ºä»€ä¹ˆéœ€è¦-container_of>1. ä¸ºä»€ä¹ˆéœ€è¦ <code>container_of</code>ï¼Ÿ</h3><p>C è¯­è¨€æ²¡æœ‰å†…ç½®çš„æœºåˆ¶å¯ä»¥ä»æˆå‘˜æŒ‡é’ˆåæ¨å®¿ä¸»ç»“æ„ä½“æŒ‡é’ˆã€‚è€Œå®é™…å¼€å‘ä¸­ï¼ˆå°¤å…¶æ˜¯åœ¨å®ç°é€šç”¨å®¹å™¨ã€é“¾è¡¨ã€é¢å‘å¯¹è±¡é£æ ¼çš„ä»£ç æ—¶ï¼‰ï¼Œè¿™ä¸€åŠŸèƒ½æå…¶é‡è¦ã€‚</p><hr><h3 id=3-offsetof-çš„å®ç°å®‰å…¨å—>3. <code>offsetof</code> çš„å®ç°å®‰å…¨å—ï¼Ÿ</h3><p>âœ… æ˜¯çš„ã€‚è™½ç„¶å®ƒä½¿ç”¨äº† <code>(type *)0</code>ï¼Œä½†<strong>ä»…ç”¨äºè®¡ç®—æˆå‘˜åœ°å€ï¼Œè€Œå¹¶æœªçœŸæ­£è®¿é—®è¯¥åœ°å€çš„å†…å­˜</strong>ï¼Œå› æ­¤æ˜¯å®‰å…¨çš„ã€‚</p><hr><h3 id=4-container_of-è¿”å›çš„æ˜¯ä»€ä¹ˆ>4. <code>container_of</code> è¿”å›çš„æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>å®ƒè¿”å›ä¸€ä¸ª <strong>æŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆ</strong>ï¼Œç±»å‹ä¸º <code>type *</code>ï¼Œå³ä½ ä¼ å…¥çš„ç»“æ„ä½“ç±»å‹ã€‚</p><p>å®ƒ<strong>ä¸æ˜¯å¸¸æ•°ï¼Œä¹Ÿä¸æ˜¯å®ç›´æ¥æ›¿æ¢ä¸ºå€¼</strong>ï¼Œè€Œæ˜¯åœ¨é¢„å¤„ç†é˜¶æ®µå±•å¼€ä¸ºä¸€æ®µä»£ç ï¼Œæœ€ç»ˆåœ¨è¿è¡Œæ—¶è®¡ç®—å¹¶è¿”å›ä¸€ä¸ªæŒ‡é’ˆã€‚</p><hr><h3 id=5-ä¸ºä»€ä¹ˆä½¿ç”¨-typeofåœ¨-gcc-ç‰ˆæœ¬ä¸­>5. ä¸ºä»€ä¹ˆä½¿ç”¨ <code>typeof</code>ï¼ˆåœ¨ GCC ç‰ˆæœ¬ä¸­ï¼‰ï¼Ÿ</h3><p><code>typeof</code> ç”¨äº<strong>è‡ªåŠ¨æ¨å¯¼æˆå‘˜çš„ç±»å‹</strong>ï¼Œä½¿å¾— <code>container_of</code> å®å¯ä»¥é€‚ç”¨äº<strong>ä»»æ„ç»“æ„ä½“å’Œä»»æ„æˆå‘˜</strong>ï¼Œå…·æœ‰é«˜åº¦çš„é€šç”¨æ€§ã€‚æ ‡å‡† C ä¸­å¯ç”¨æ˜¾å¼ç±»å‹æ›¿ä»£ï¼Œä½†é€šç”¨æ€§ä¼šé™ä½ã€‚</p><hr><h2 id=ä¹æ€»ç»“>ä¹ã€æ€»ç»“</h2><div class=table-wrapper><table><thead><tr><th>é¡¹ç›®</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>ä½œç”¨</strong></td><td>é€šè¿‡ç»“æ„ä½“æˆå‘˜çš„æŒ‡é’ˆï¼Œè·å–åŒ…å«è¯¥æˆå‘˜çš„æ•´ä¸ªç»“æ„ä½“çš„æŒ‡é’ˆ</td></tr><tr><td><strong>æ ¸å¿ƒåŸç†</strong></td><td>æˆå‘˜æŒ‡é’ˆ - æˆå‘˜åç§»é‡ = ç»“æ„ä½“èµ·å§‹åœ°å€</td></tr><tr><td><strong>å…³é”®å®</strong></td><td><code>offsetof(type, member)</code>ï¼šè®¡ç®—æˆå‘˜åç§»é‡</td></tr><tr><td><strong>å®ç°æ–¹å¼</strong></td><td>æŒ‡é’ˆè¿ç®—ï¼š<code>(char *)member_ptr - offsetof(...)</code></td></tr><tr><td><strong>å…¸å‹åº”ç”¨</strong></td><td>Linux å†…æ ¸é“¾è¡¨ã€è®¾å¤‡æ¨¡å‹ã€é€šç”¨å®¹å™¨ã€é¢å‘å¯¹è±¡é£æ ¼ä»£ç </td></tr><tr><td><strong>æ‰©å±•çŸ¥è¯†</strong></td><td>æ¶‰åŠæŒ‡é’ˆç±»å‹è½¬æ¢ã€å®ç¼–ç¨‹ã€ç¼–è¯‘æœŸè®¡ç®—ã€å†…å­˜æ¨¡å‹ç­‰ C è¯­è¨€é«˜çº§ä¸»é¢˜</td></tr></tbody></table></div></section><div class=post-reward data-html2canvas-ignore><input type=checkbox name=reward id=reward hidden>
<label class=reward-button for=reward>èµèµæ”¯æŒ</label><div class=qr-code><label class=qr-code-image for=reward><img class=image src=https://tuchuang.liushuiyu.cn/img/wxzf.webp>
<span>å¾®ä¿¡æ‰“èµ</span>
</label><label class=qr-code-image for=reward><img class=image src=https://tuchuang.liushuiyu.cn/img/zfbzf.webp>
<span>æ”¯ä»˜å®æ‰“èµ</span></label></div></div><footer class=article-footer><section class=article-tags><a href=/tags/linux/>Linux</a>
<a href=/tags/%E7%BC%96%E7%A8%8B/>ç¼–ç¨‹</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article class="article-card has-image"><a href=/p/%E7%94%A8-gcc-%E5%AE%9E%E7%8E%B0%E6%A8%A1%E5%9D%97%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%86%8C%E5%88%9D%E5%A7%8B%E5%8C%96%E6%9C%BA%E5%88%B6/><div class=article-image><img src=https://tuchuang.liushuiyu.cn/img/c-jingjie-logo320250911.webp loading=lazy data-key data-hash=https://tuchuang.liushuiyu.cn/img/c-jingjie-logo320250911.webp></div><div class=article-details><h2 class=article-title>ç”¨ GCC å®ç°æ¨¡å—è‡ªåŠ¨æ³¨å†Œåˆå§‹åŒ–æœºåˆ¶</h2></div></a></article><article class="article-card has-image"><a href=/p/c%E8%AF%AD%E8%A8%80%E8%BF%9B%E9%98%B6%E5%86%85%E5%AD%98%E4%B8%8Eunion%E7%9A%84%E5%AE%8C%E7%BE%8E%E7%BB%93%E5%90%88/><div class=article-image><img src=https://tuchuang.liushuiyu.cn/img/c-jingjie-logo220250902.webp loading=lazy data-key data-hash=https://tuchuang.liushuiyu.cn/img/c-jingjie-logo220250902.webp></div><div class=article-details><h2 class=article-title>Cè¯­è¨€è¿›é˜¶ï¼šå†…å­˜ä¸unionçš„å®Œç¾ç»“åˆ</h2></div></a></article><article class="article-card has-image"><a href=/p/c%E8%AF%AD%E8%A8%80%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%E5%AE%8F%E5%9C%A8log%E8%B0%83%E8%AF%95%E4%B8%AD%E7%9A%84%E8%89%BA%E6%9C%AF/><div class=article-image><img src=https://tuchuang.liushuiyu.cn/img/c-jingjie-logo20250901.webp loading=lazy data-key data-hash=https://tuchuang.liushuiyu.cn/img/c-jingjie-logo20250901.webp></div><div class=article-details><h2 class=article-title>Cè¯­è¨€è¿›é˜¶æ•™ç¨‹ï¼šå®åœ¨Logè°ƒè¯•ä¸­çš„è‰ºæœ¯</h2></div></a></article><article class="article-card has-image"><a href=/p/c-%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88unique_ptr%E4%B8%8Emake_unique/><div class=article-image><img src=https://tuchuang.liushuiyu.cn/img/ptr-logo20250901.webp loading=lazy data-key data-hash=https://tuchuang.liushuiyu.cn/img/ptr-logo20250901.webp></div><div class=article-details><h2 class=article-title>C++æ™ºèƒ½æŒ‡é’ˆunique_ptrâ€‹ä¸make_unique</h2></div></a></article><article class="article-card has-image"><a href=/p/c-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E4%B8%8E%E6%8B%B7%E8%B4%9D%E6%8E%A7%E5%88%B6%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/><div class=article-image><img src=https://tuchuang.liushuiyu.cn/img/copy-logo20250831.webp loading=lazy data-key data-hash=https://tuchuang.liushuiyu.cn/img/copy-logo20250831.webp></div><div class=article-details><h2 class=article-title>C++æ„é€ å‡½æ•°ä¸æ‹·è´æ§åˆ¶å®Œå…¨æŒ‡å—</h2></div></a></article></div></div></aside><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><script src=https://blog.liushuiyu.cn/background/sakura.js></script><style>#TableOfContents>ul,ol{ul, ol { display: none; } .open { display: block; }}</style><script>function initTocHide(){let e=document.querySelector(".widget--toc");if(!e)return;window.addEventListener("scroll",function(){let t=document.querySelector(".active-class");if(!t)return;let n=document.querySelectorAll(".open");n.length>0&&n.forEach(e=>{e.classList.remove("open")}),t.children.length>1&&t.children[1].classList.add("open");let e=t.parentElement;do e.classList.add("open"),e=e.parentElement.parentElement;while(e!==0[0]&&(e.localName==="ul"||e.localName==="ol"))})}initTocHide()</script><style>footer.site-footer{width:100%;position:relative;bottom:0;padding:20px 10px;font-size:1.3rem;font-weight:600;line-height:1.75;color:var(--card-text-color-secondary);background-color:var(--footer-bg);box-shadow:0 -3px 1px -3px var(--card-text-color-main);padding:10px;user-select:none}.footer-info{display:grid;grid-template-columns:1fr auto}.right-footer{text-align:left;display:flex;align-items:right}footer.site-footer a{font-size:15px;color:var(--card-text-color-main);transition:color .2s ease-in-out;margin-inline:15px}.copyright{font-size:15px;color:var(--card-text-color-main)!important;transition:color .2s ease-in-out;margin-inline:15px}</style><div style=display:flex;justify-content:center;align-items:center;flex-direction:column;margin-top:60px;color:var(--card-text-color-main);margin:30px></div><footer class=site-footer><div class=footer-info><div class=left-footer><section class=copyright>&copy;
2024 -
2025 liushuiyu</section></div><section class=totalcount>å‘è¡¨äº†16ç¯‡æ–‡ç«  Â·
æ€»è®¡6.33kå­—</section></div></footer></body></html>